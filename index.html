
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>çº¢è–¯ç”Ÿæ„å…¨èƒ½ç®¡å®¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
      }
      @keyframes placeholder-fade {
        0%,
        100% {
          opacity: 0.4;
        }
        50% {
          opacity: 1;
        }
      }
      .placeholder-animate::placeholder {
        animation: placeholder-fade 3s infinite ease-in-out;
      }
      /* Custom styles for the range slider track */
      .slider-track {
        --slider-color: #4ade80; /* Default green color */
        -webkit-appearance: none;
        appearance: none;
        background: transparent;
      }
      .slider-track::-webkit-slider-runnable-track {
        height: 1.25rem;
        border-radius: 9999px;
        background: var(--slider-color);
        transition: background 0.2s ease-in-out;
      }
      .slider-track::-moz-range-track {
        height: 1.25rem;
        border-radius: 9999px;
        background: var(--slider-color);
        transition: background 0.2s ease-in-out;
      }
       .slider-track::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        margin-top: -6px; /* Position thumb vertically */
        background-color: white;
        height: 2.25rem;
        width: 2.25rem;
        border-radius: 9999px;
        border: 4px solid #64748b;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
      }
      .slider-track::-moz-range-thumb {
        background-color: white;
        height: 2.25rem;
        width: 2.25rem;
        border-radius: 9999px;
        border: 4px solid #64748b;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
      }
    </style>
    <!-- Babel for in-browser JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- React and ReactDOM UMD builds -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script type="text/babel">
        // All React code is now inlined here
        const { useState, useMemo, useEffect } = React;

        const SETTINGS_KEY = 'sweetPotatoCalculatorSettings';

        // --- Reusable UI Components (Shared Across Pages) ---

        const InputWithSteppers = ({ label, unit, value, onChange: propOnChange, placeholder, type = "number", step = 10, integerOnly = true }) => {
            const handleStep = (amount) => {
                const currentValue = parseFloat(value) || 0;
                const newValue = Math.max(0, currentValue + amount);
                const event = { target: { value: String(newValue) } };
                propOnChange(event);
            };

            const handleInputChange = (e) => {
                const { value } = e.target;
                if (value === '' || (integerOnly ? /^\d*$/.test(value) : /^\d*\.?\d*$/.test(value))) {
                    propOnChange(e);
                }
            };
            
            return (
                <div className="mb-4">
                    <label className="block text-2xl font-medium text-gray-700 mb-2">{label}</label>
                    <div className="flex items-center">
                        <button 
                            type="button"
                            onClick={() => handleStep(-step)} 
                            className="text-5xl font-bold text-blue-600 bg-blue-100 rounded-l-xl px-5 h-20 hover:bg-blue-200 active:scale-95 transition-transform"
                            aria-label={`Decrease by ${step}`}
                        >
                            -
                        </button>
                        <div className="relative flex-grow">
                            <input 
                                type={type} 
                                value={value} 
                                onChange={handleInputChange} 
                                placeholder={placeholder} 
                                className="w-full text-4xl p-4 bg-white border-y-2 border-blue-500 h-20 text-center font-bold outline-none" 
                                pattern="\d*" 
                                inputMode={type === 'number' ? 'decimal' : 'text'} 
                            />
                            <span className="absolute right-4 top-1/2 -translate-y-1/2 text-2xl font-semibold text-gray-500 pointer-events-none">{unit}</span>
                        </div>
                        <button 
                            type="button"
                            onClick={() => handleStep(step)} 
                            className="text-5xl font-bold text-blue-600 bg-blue-100 rounded-r-xl px-5 h-20 hover:bg-blue-200 active:scale-95 transition-transform"
                            aria-label={`Increase by ${step}`}
                        >
                            +
                        </button>
                    </div>
                </div>
            );
        };


        const SettingInput = ({ label, unit, value, onChange }) => (
            <div className="flex items-center justify-between mb-2">
                <label className="text-xl text-gray-600">{label}</label>
                <div className="flex items-center w-36 bg-white border border-gray-300 rounded-md">
                    <input type="number" value={value} onChange={onChange} className="w-full text-xl p-2 bg-transparent outline-none text-right" pattern="\d*\.?\d*" inputMode="decimal" />
                    <span className="text-lg text-gray-500 pr-2">{unit}</span>
                </div>
            </div>
        );

        const SalesCard = ({ title, bgColor, wholesaleCount, setWholesaleCount, retailCount, setRetailCount }) => (
            <div className={`${bgColor} border rounded-xl p-4 mb-6`}>
                <h3 className="text-2xl font-bold text-slate-800 mb-4">{title}</h3>
                <InputWithSteppers label="æ‰¹å‘ä»·å–äº†å¤šå°‘è¢‹ï¼Ÿ" unit="è¢‹" value={wholesaleCount} onChange={e => setWholesaleCount(e.target.value)} placeholder="0" />
                <InputWithSteppers label="é›¶å”®ä»·å–äº†å¤šå°‘è¢‹ï¼Ÿ" unit="è¢‹" value={retailCount} onChange={e => setRetailCount(e.target.value)} placeholder="0" />
            </div>
        );

        const RateButton = ({ label, isSelected, onClick }) => (
          <button
            type="button"
            onClick={onClick}
            className={`w-full py-4 text-xl sm:text-2xl font-bold rounded-xl transition-all duration-200 ease-in-out transform active:scale-95 shadow-md ${
              isSelected
                ? 'bg-emerald-600 text-white ring-4 ring-emerald-300'
                : 'bg-gray-200 text-gray-800 hover:bg-gray-300'
            }`}
          >
            {label}
          </button>
        );

        const CostToggleInput = ({ id, label, isChecked, onToggleChange, costValue, onCostChange }) => (
            <div className="flex items-center justify-between bg-white p-2 rounded-lg border-2 mb-4">
                <div className="flex items-center">
                    <input 
                        id={id} 
                        type="checkbox" 
                        checked={isChecked} 
                        onChange={e => onToggleChange(e.target.checked)} 
                        className="h-8 w-8 accent-rose-600" 
                    />
                    <label htmlFor={id} className="ml-4 text-2xl font-medium">{label}</label>
                </div>
                <div className="flex items-center">
                    <span className="text-2xl font-medium mr-2">+</span>
                    <input 
                        type="number" 
                        value={costValue}
                        onChange={e => onCostChange(e.target.value)}
                        className="w-24 text-2xl font-bold text-right bg-gray-100 rounded-md p-2 outline-none border border-gray-300 focus:ring-2 focus:ring-rose-400"
                        inputMode="decimal"
                    />
                    <span className="text-2xl font-medium ml-2">å…ƒ</span>
                </div>
            </div>
        );

        const ProgressBar = ({ grossProfit, totalMiscFees }) => {
            if (totalMiscFees <= 0) return null;
            const progress = Math.min(100, (grossProfit / totalMiscFees) * 100);
            const isBreakEven = progress >= 100;
            const amountToBreakEven = totalMiscFees - grossProfit;

            return (
                <div className="my-6">
                    <div className="w-full bg-gray-300 rounded-full h-8 border border-gray-400 overflow-hidden">
                        <div 
                            className={`h-full rounded-full transition-all duration-500 ease-out ${isBreakEven ? 'bg-green-500' : 'bg-red-500'}`} 
                            style={{ width: `${progress}%` }}
                        ></div>
                    </div>
                    <p className={`text-center text-xl mt-2 font-bold ${isBreakEven ? 'text-green-700' : 'text-red-700'}`}>
                        {isBreakEven 
                            ? "æ­å–œï¼å·²å›æœ¬ï¼Œç°åœ¨å¼€å§‹èµšé’±ï¼" 
                            : `åŠ æ²¹ï¼è¿˜å·® ${amountToBreakEven.toFixed(2)} å…ƒå›æœ¬`}
                    </p>
                </div>
            );
        };

        // --- Page 1: Purchase Advisor (è‰ç¨¿æ¨¡å¼) ---
        const PurchaseAdvisor = () => {
            const [totalPrice, setTotalPrice] = useState('');
            const [totalWeight, setTotalWeight] = useState('');
            const [deductionRate, setDeductionRate] = useState(0.05);
            const [miscCosts, setMiscCosts] = useState('300');
            const [estimatedSellPrice, setEstimatedSellPrice] = useState('');
            const [result, setResult] = useState(null);

            const handleCalculate = () => {
                const price = parseFloat(totalPrice) || 0;
                const weight = parseFloat(totalWeight) || 0;
                const misc = parseFloat(miscCosts) || 0;
                const sellPrice = parseFloat(estimatedSellPrice) || 0;

                if (price <= 0 || weight <= 0 || sellPrice <= 0) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„æŠ¥ä»·ã€æ€»é‡å’Œé¢„ä¼°å–ä»·ï¼');
                    setResult(null);
                    return;
                }

                const netWeight = weight * (1 - deductionRate);
                if (netWeight <= 0) {
                    alert('æ€»é‡æ‰£é™¤æ‚è´¨åéœ€å¤§äº0ï¼');
                    setResult(null);
                    return;
                }
                
                const trueCostPerJin = price / netWeight;
                const estimatedGrossProfit = (netWeight * sellPrice) - (price + misc);
                const PROFIT_THRESHOLD = 1000;
                const isProfitable = estimatedGrossProfit > PROFIT_THRESHOLD;

                let suggestedTotalPrice = null;
                let suggestedCostPerJin = null;

                if (!isProfitable) {
                    suggestedTotalPrice = (netWeight * sellPrice) - misc - PROFIT_THRESHOLD;
                    suggestedCostPerJin = suggestedTotalPrice > 0 ? suggestedTotalPrice / netWeight : 0;
                }

                setResult({
                    trueCostPerJin,
                    estimatedGrossProfit,
                    isProfitable,
                    suggestedTotalPrice,
                    suggestedCostPerJin
                });
            };
            
            return (
                <div className="w-full max-w-lg bg-white p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-200">
                    <h1 className="text-4xl sm:text-5xl font-bold text-slate-800 text-center mb-8">è¿›è´§å‚è€ƒ</h1>
                    <InputWithSteppers label="å¯¹æ–¹æŠ¥ä»·æ€»é¢" unit="å…ƒ" value={totalPrice} onChange={e => setTotalPrice(e.target.value)} placeholder="ä¾‹å¦‚ 8000" step={100} integerOnly={false} />
                    <InputWithSteppers label="å¯¹æ–¹ç§°é‡æ€»é‡" unit="æ–¤" value={totalWeight} onChange={e => setTotalWeight(e.target.value)} placeholder="ä¾‹å¦‚ 10000" step={100} integerOnly={false} />
                    
                    <div className="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
                        <h3 className="text-2xl font-bold text-amber-800 mb-3">æ‚è´¨/çš®é‡æ‰£é™¤</h3>
                        <div className="grid grid-cols-3 gap-2 sm:gap-3">
                            <button onClick={() => setDeductionRate(0)} className={`py-3 text-lg font-bold rounded-lg ${deductionRate === 0 ? 'bg-amber-600 text-white' : 'bg-amber-200'}`}>å¹²å‡€è´§ (ä¸æ‰£)</button>
                            <button onClick={() => setDeductionRate(0.05)} className={`py-3 text-lg font-bold rounded-lg ${deductionRate === 0.05 ? 'bg-amber-600 text-white' : 'bg-amber-200'}`}>ä¸€èˆ¬å¸¦æ³¥ (-5%)</button>
                            <button onClick={() => setDeductionRate(0.10)} className={`py-3 text-lg font-bold rounded-lg ${deductionRate === 0.10 ? 'bg-amber-600 text-white' : 'bg-amber-200'}`}>æ³¥å¤§/å¸¦ç­ (-10%)</button>
                        </div>
                    </div>

                    <InputWithSteppers label="é¢„ä¼°å¹³å‡å–ä»·" unit="å…ƒ/æ–¤" value={estimatedSellPrice} onChange={e => setEstimatedSellPrice(e.target.value)} placeholder="ä¾‹å¦‚ 1.2" step={0.1} integerOnly={false} />
                    <InputWithSteppers label="æ‹‰å›è¿è´¹/æ‚è´¹" unit="å…ƒ" value={miscCosts} onChange={e => setMiscCosts(e.target.value)} placeholder="é»˜è®¤ 300" step={50} integerOnly={false} />

                    <button onClick={handleCalculate} className="w-full bg-blue-600 text-white text-4xl font-bold py-5 rounded-xl shadow-lg mt-4">å¿«é€Ÿä¼°ç®—</button>
                    
                    {result && (
                        <div className="mt-8 space-y-6">
                            <div className="p-4 rounded-xl border-2 border-orange-400 bg-orange-50 text-center">
                                <p className="text-xl font-bold text-orange-800">çœŸç›¸æš´å‡»ï¼š</p>
                                <p className="text-2xl text-gray-700 mt-1">
                                    æŠ˜ç®—åçœŸå®æˆæœ¬: 
                                    <span className="text-5xl font-extrabold text-orange-600 ml-2">
                                        {result.trueCostPerJin.toFixed(2)}
                                    </span> å…ƒ/æ–¤
                                </p>
                            </div>

                            {result.isProfitable ? (
                                <div className="p-6 rounded-xl border-2 border-green-500 bg-green-100 text-center">
                                    <p className="text-4xl font-bold text-green-700">ğŸŸ¢ å¯ä»¥æ‹¿ï¼è¿™è½¦ç¨³èµšï¼</p>
                                    <p className="text-xl text-green-600 mt-2">é¢„è®¡å‡€èµšçº¦ <span className="text-3xl font-bold">{result.estimatedGrossProfit.toFixed(0)}</span> å…ƒ</p>
                                </div>
                            ) : (
                                 <div className="p-6 rounded-xl border-2 border-red-500 bg-red-100 text-center">
                                    <p className="text-4xl font-bold text-red-700">ğŸ”´ é£é™©å¤§ï¼åˆ«å†²åŠ¨ï¼</p>
                                    <p className="text-xl text-red-600 mt-2">
                                        æƒ³èµšé’± (èµš1000å…ƒ)ï¼Œå¿…é¡»æŠŠæ€»ä»·ç åˆ° 
                                        <span className="block text-4xl font-extrabold text-red-700 my-2">
                                            {Math.max(0, result.suggestedTotalPrice).toFixed(0)} å…ƒ
                                        </span> 
                                        ({Math.max(0, result.suggestedCostPerJin).toFixed(2)}å…ƒ/æ–¤) ä»¥ä¸‹ï¼
                                    </p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };


        // --- Page 2: Daily Ledger (å®æˆ˜æ¨¡å¼) ---
        const DailyLedger = () => {
            // --- Global Settings (persisted) ---
            const [purchasePrice, setPurchasePrice] = useState('0.8');
            const [wholesalePrice, setWholesalePrice] = useState('2.2');
            const [retailPrice, setRetailPrice] = useState('2.8');
            const [sandbagWeight, setSandbagWeight] = useState('3.5');
            const [sandbagCost, setSandbagCost] = useState('0.2');
            const [plasticBagWeight, setPlasticBagWeight] = useState('5.0');
            const [plasticBagCost, setPlasticBagCost] = useState('0.1');
            const [laborMode, setLaborMode] = useState('one_person');
            const [customPeopleCount, setCustomPeopleCount] = useState('');
            const [isStoveOn, setIsStoveOn] = useState(false);
            const [stoveCost, setStoveCost] = useState('50');
            const [isAcOn, setIsAcOn] = useState(false);
            const [acCost, setAcCost] = useState('30');
            const [spoilageRate, setSpoilageRate] = useState(0.05);
            const [dailyMoistureLossRate, setDailyMoistureLossRate] = useState('1.0');

            // --- Daily Input State ---
            const [daysStored, setDaysStored] = useState(0);
            const [fuelCost, setFuelCost] = useState('50');
            const [sandbagWholesale, setSandbagWholesale] = useState('');
            const [sandbagRetail, setSandbagRetail] = useState('');
            const [plasticBagWholesale, setPlasticBagWholesale] = useState('');
            const [plasticBagRetail, setPlasticBagRetail] = useState('');
            const [rottenWeight, setRottenWeight] = useState('');

            // --- Result State ---
            const [result, setResult] = useState(null);

            useEffect(() => {
                try {
                    const savedSettings = JSON.parse(localStorage.getItem(SETTINGS_KEY));
                    if (savedSettings) {
                        setPurchasePrice(savedSettings.purchasePrice ?? '0.8');
                        setWholesalePrice(savedSettings.wholesalePrice ?? '2.2');
                        setRetailPrice(savedSettings.retailPrice ?? '2.8');
                        setSandbagWeight(savedSettings.sandbagWeight ?? '3.5');
                        setSandbagCost(savedSettings.sandbagCost ?? '0.2');
                        setPlasticBagWeight(savedSettings.plasticBagWeight ?? '5.0');
                        setPlasticBagCost(savedSettings.plasticBagCost ?? '0.1');
                        setLaborMode(savedSettings.laborMode ?? 'one_person');
                        setCustomPeopleCount(savedSettings.customPeopleCount ?? '');
                        setIsStoveOn(savedSettings.isStoveOn ?? false);
                        setStoveCost(savedSettings.stoveCost ?? '50');
                        setIsAcOn(savedSettings.isAcOn ?? false);
                        setAcCost(savedSettings.acCost ?? '30');
                        setSpoilageRate(savedSettings.spoilageRate ?? 0.05);
                        setDailyMoistureLossRate(savedSettings.dailyMoistureLossRate ?? '1.0');
                    }
                } catch (error) { console.error("Failed to load settings", error); }
            }, []);

            useEffect(() => {
                const settingsToSave = {
                    purchasePrice, wholesalePrice, retailPrice, sandbagWeight, sandbagCost,
                    plasticBagWeight, plasticBagCost, laborMode, customPeopleCount,
                    isStoveOn, stoveCost, isAcOn, acCost, spoilageRate, dailyMoistureLossRate
                };
                try { localStorage.setItem(SETTINGS_KEY, JSON.stringify(settingsToSave)); } 
                catch (error) { console.error("Failed to save settings", error); }
            }, [
                purchasePrice, wholesalePrice, retailPrice, sandbagWeight, sandbagCost,
                plasticBagWeight, plasticBagCost, laborMode, customPeopleCount,
                isStoveOn, stoveCost, isAcOn, acCost, spoilageRate, dailyMoistureLossRate
            ]);

            const laborCost = useMemo(() => {
                if (laborMode === 'one_person') return 90;
                if (laborMode === 'two_people') return 180;
                if (laborMode === 'custom') return (parseInt(customPeopleCount) || 0) * 90;
                return 90;
            }, [laborMode, customPeopleCount]);

            const actualPurchasePrice = useMemo(() => {
                const pPrice = parseFloat(purchasePrice) || 0;
                const lossRate = (parseFloat(dailyMoistureLossRate) || 0) / 100;
                const discountFactor = 1 - (daysStored * lossRate);
                if (pPrice === 0 || discountFactor <= 0.1) return pPrice;
                return pPrice / discountFactor;
            }, [purchasePrice, daysStored, dailyMoistureLossRate]);

            const sliderBgColor = useMemo(() => `hsl(${120 - (daysStored * (120 / 15))}, 70%, 50%)`, [daysStored]);

            const handleCalculate = () => {
                const wsPrice = parseFloat(wholesalePrice) || 0, rtPrice = parseFloat(retailPrice) || 0,
                      sbWeight = parseFloat(sandbagWeight) || 0, sbCost = parseFloat(sandbagCost) || 0,
                      pbWeight = parseFloat(plasticBagWeight) || 0, pbCost = parseFloat(plasticBagCost) || 0,
                      sCost = parseFloat(stoveCost) || 0, aCost = parseFloat(acCost) || 0,
                      fuelCostFloat = parseFloat(fuelCost) || 0, rottenWeightFloat = parseFloat(rottenWeight) || 0,
                      sbWholesaleCount = parseInt(sandbagWholesale) || 0, sbRetailCount = parseInt(sandbagRetail) || 0,
                      pbWholesaleCount = parseInt(plasticBagWholesale) || 0, pbRetailCount = parseInt(plasticBagRetail) || 0;

                const totalWeightSold = (sbWholesaleCount + sbRetailCount) * sbWeight + (pbWholesaleCount + pbRetailCount) * pbWeight;
                if (totalWeightSold <= 0) { alert("è¿˜æ²¡æœ‰å–è´§ï¼Œæ²¡æ³•è®¡ç®—å“¦ï¼"); return; }

                const totalBagCost = (sbWholesaleCount + sbRetailCount) * sbCost + (pbWholesaleCount + pbRetailCount) * pbCost;
                const totalRevenue = (sbWholesaleCount * sbWeight * wsPrice) + (sbRetailCount * sbWeight * rtPrice) + (pbWholesaleCount * pbWeight * wsPrice) + (pbRetailCount * pbWeight * rtPrice);
                const spoilageCost = rottenWeightFloat * actualPurchasePrice;
                const totalMiscFees = laborCost + (isStoveOn ? sCost : 0) + (isAcOn ? aCost : 0) + fuelCostFloat + totalBagCost + spoilageCost;
                const originalPurchasedWeight = totalWeightSold / (1 - spoilageRate);
                const totalPurchaseCost = originalPurchasedWeight * actualPurchasePrice;
                const totalExpenses = totalPurchaseCost + totalMiscFees;
                const netProfit = totalRevenue - totalExpenses;
                const grossProfit = totalRevenue - totalPurchaseCost;
                const actualBreakEvenPrice = totalExpenses / totalWeightSold;
                const averageSellingPrice = totalRevenue / totalWeightSold;

                setResult({ netProfit, totalWeightSold, totalMiscFees, actualBreakEvenPrice, averageSellingPrice, grossProfit });
            };

            const handleClear = () => {
                if (window.confirm("ç¡®å®šè¦æ¸…ç©ºä»Šå¤©çš„è´¦å•å—ï¼Ÿ")) {
                    setDaysStored(0); setFuelCost('50'); setSandbagWholesale(''); setSandbagRetail('');
                    setPlasticBagWholesale(''); setPlasticBagRetail(''); setRottenWeight(''); setResult(null);
                }
            };

            const handleCopy = () => {
                if (!result) return;
                const d = new Date();
                const today = `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
                const summary = `ã€çº¢è–¯ç”Ÿæ„è´¦å•ã€‘\næ—¥æœŸ: ${today}\nå­˜æ”¾å¤©æ•°: ${daysStored} å¤©\næ€»é”€é‡: ${result.totalWeightSold.toFixed(1)} æ–¤\næ€»å‡€èµš: ${result.netProfit.toFixed(2)} å…ƒ\nå®é™…æˆæœ¬: ${result.actualBreakEvenPrice.toFixed(2)} å…ƒ/æ–¤\nä»Šæ—¥æŸè€—: ${parseFloat(rottenWeight) || 0} æ–¤`;
                navigator.clipboard.writeText(summary).then(() => alert("å·²å¤åˆ¶ï¼Œå»å¾®ä¿¡ç²˜è´´ï¼")).catch(err => alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚"));
            };

            const isProfit = result && result.netProfit >= 0;

            return (
                <div className="w-full max-w-lg bg-white p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-200">
                    <h1 className="text-4xl sm:text-5xl font-bold text-slate-800 text-center mb-6">ä»Šæ—¥è®°è´¦</h1>
                    
                    <div className="bg-indigo-50 border-2 border-indigo-200 rounded-xl p-6 mb-8 text-center">
                        <h2 className="text-3xl font-bold text-indigo-800 mb-4">è¿™è½¦è´§æ”¾äº†å‡ å¤©äº†ï¼Ÿ</h2>
                        <input type="range" min="0" max="15" value={daysStored} onChange={(e) => setDaysStored(parseInt(e.target.value))} style={{'--slider-color': sliderBgColor }} className="w-full h-5 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-track"/>
                        <p className="text-2xl font-bold text-indigo-700 mt-4">{daysStored === 0 ? "åˆšè¿›è´§ (æ— æŠ˜æŸ)" : `ç¬¬ ${daysStored} å¤© (é‡é‡ç¼©æ°´ ${(daysStored * (parseFloat(dailyMoistureLossRate) || 0)).toFixed(1)}%)`}</p>
                        <div className={`mt-3 p-3 rounded-lg ${actualPurchasePrice > (parseFloat(purchasePrice) * 1.1) ? 'bg-red-100' : 'bg-indigo-100'}`}>
                            <p className="text-xl font-medium text-gray-700">ä»Šæ—¥å®é™…æˆæœ¬ï¼š</p>
                            <p className={`text-5xl font-extrabold transition-colors ${actualPurchasePrice > (parseFloat(purchasePrice) * 1.1) ? 'text-red-600' : 'text-indigo-900'}`}>{actualPurchasePrice.toFixed(2)} <span className="text-3xl">å…ƒ/æ–¤</span></p>
                        </div>
                    </div>

                    <details className="bg-gray-100 rounded-lg p-3 mb-6 border border-gray-300">
                        <summary className="text-xl font-bold text-gray-700 cursor-pointer">åŸºç¡€è®¾ç½® (ç‚¹æˆ‘ä¿®æ”¹)</summary>
                        <div className="mt-4 pt-4 border-t border-gray-300 space-y-3">
                            <SettingInput label="è¿›è´§ä»·" unit="å…ƒ/æ–¤" value={purchasePrice} onChange={e => setPurchasePrice(e.target.value)} />
                            <SettingInput label="æ‰¹å‘å–ä»·" unit="å…ƒ/æ–¤" value={wholesalePrice} onChange={e => setWholesalePrice(e.target.value)} />
                            <SettingInput label="é›¶å”®å–ä»·" unit="å…ƒ/æ–¤" value={retailPrice} onChange={e => setRetailPrice(e.target.value)} />
                            <hr className="my-3"/><SettingInput label="å°æ²™è¢‹é‡" unit="æ–¤" value={sandbagWeight} onChange={e => setSandbagWeight(e.target.value)} /><SettingInput label="å°æ²™è¢‹æˆæœ¬" unit="å…ƒ" value={sandbagCost} onChange={e => setSandbagCost(e.target.value)} />
                            <hr className="my-3"/><SettingInput label="å¡‘æ–™è¢‹é‡" unit="æ–¤" value={plasticBagWeight} onChange={e => setPlasticBagWeight(e.target.value)} /><SettingInput label="å¡‘æ–™è¢‹æˆæœ¬" unit="å…ƒ" value={plasticBagCost} onChange={e => setPlasticBagCost(e.target.value)} />
                            <hr className="my-3"/><SettingInput label="æ¯æ—¥æ°´åˆ†æŠ˜æŸç‡" unit="%" value={dailyMoistureLossRate} onChange={e => setDailyMoistureLossRate(e.target.value)} />
                        </div>
                    </details>

                    <div className="bg-rose-50 border border-rose-200 rounded-xl p-4 mb-6">
                        <h2 className="text-3xl font-bold text-rose-800 mb-4">å›ºå®šæˆæœ¬</h2>
                        <div className="grid grid-cols-3 gap-3 mb-4">
                           <button onClick={() => { setLaborMode('one_person'); setCustomPeopleCount(''); }} className={`py-3 text-xl font-bold rounded-lg ${laborMode === 'one_person' ? 'bg-rose-600 text-white' : 'bg-rose-200'}`}>1äºº (90å…ƒ)</button>
                           <button onClick={() => { setLaborMode('two_people'); setCustomPeopleCount(''); }} className={`py-3 text-xl font-bold rounded-lg ${laborMode === 'two_people' ? 'bg-rose-600 text-white' : 'bg-rose-200'}`}>2äºº (180å…ƒ)</button>
                           <button onClick={() => setLaborMode('custom')} className={`py-3 text-xl font-bold rounded-lg ${laborMode === 'custom' ? 'bg-rose-600 text-white' : 'bg-rose-200'}`}>è‡ªå®šä¹‰</button>
                        </div>
                        {laborMode === 'custom' && <InputWithSteppers label="è‡ªå®šä¹‰äººæ•°" unit="äºº" value={customPeopleCount} onChange={e => setCustomPeopleCount(e.target.value)} placeholder="è¾“å…¥äººæ•°" />}
                        <CostToggleInput id="stove" label="å¼€ç‚‰å­" isChecked={isStoveOn} onToggleChange={setIsStoveOn} costValue={stoveCost} onCostChange={setStoveCost} />
                        <CostToggleInput id="ac" label="å¼€ç©ºè°ƒ" isChecked={isAcOn} onToggleChange={setIsAcOn} costValue={acCost} onCostChange={setAcCost} />
                        <InputWithSteppers label="æ²¹è´¹/æ‚è´¹" unit="å…ƒ" value={fuelCost} onChange={e => setFuelCost(e.target.value)} placeholder="50" integerOnly={false} />
                    </div>

                    <div className="bg-emerald-50 border border-emerald-200 rounded-xl p-4 mb-6">
                        <h2 className="text-3xl font-bold text-emerald-800 mb-4">è´§ç‰©æŸè€—ç‡</h2>
                        <div className="grid grid-cols-3 gap-3 sm:gap-4">{[{ label: 'å¥½è´§ 2%', value: 0.02 }, { label: 'é€šè´§ 5%', value: 0.05 }, { label: 'å·®è´§ 10%', value: 0.10 }].map(o => (<RateButton key={o.value} label={o.label} isSelected={spoilageRate === o.value} onClick={() => setSpoilageRate(o.value)} />))}</div>
                    </div>

                    <h2 className="text-3xl font-bold text-green-800 mb-4">ä»Šæ—¥é”€é‡</h2>
                    <SalesCard title={`å°æ²™è¢‹ç”Ÿæ„ (${sandbagWeight}æ–¤)`} bgColor="bg-yellow-50 border-yellow-200" wholesaleCount={sandbagWholesale} setWholesaleCount={setSandbagWholesale} retailCount={sandbagRetail} setRetailCount={setSandbagRetail} />
                    <SalesCard title={`å¡‘æ–™è¢‹ç”Ÿæ„ (${plasticBagWeight}æ–¤)`} bgColor="bg-blue-50 border-blue-200" wholesaleCount={plasticBagWholesale} setWholesaleCount={setPlasticBagWholesale} retailCount={plasticBagRetail} setRetailCount={setPlasticBagRetail} />
                    
                    <div className="bg-red-50/80 border-2 border-red-300 rounded-xl p-4 my-6"><h2 className="text-3xl font-bold text-red-800 mb-2">æŸè€—å½•å…¥</h2><InputWithSteppers label="ä»Šå¤©æŒ‘æ‹£å‡ºå¤šå°‘æ–¤çƒ‚è´§/åè´§ï¼Ÿ" unit="æ–¤" value={rottenWeight} onChange={e => setRottenWeight(e.target.value)} placeholder="0" integerOnly={false} /></div>
                    
                    <div className="grid grid-cols-2 gap-4 mt-2">
                        <button onClick={handleClear} className="w-full bg-gray-500 text-white text-3xl font-bold py-5 rounded-xl shadow-lg hover:bg-gray-600 active:scale-95 transition-transform">æ¸…ç©ºæ•°æ®</button>
                        <button onClick={handleCalculate} className="w-full bg-blue-600 text-white text-4xl font-bold py-5 rounded-xl shadow-lg hover:bg-blue-700 active:scale-95 transition-transform">ä¸€ é”® ç®— è´¦</button>
                    </div>

                    {result !== null && (<>
                        <ProgressBar grossProfit={result.grossProfit} totalMiscFees={result.totalMiscFees} />
                        <div className={`mt-6 p-6 rounded-xl border-2 text-center ${isProfit ? 'bg-green-100 border-green-500' : 'bg-red-100 border-red-500'}`}><p className={`text-3xl font-bold mb-2 ${isProfit ? 'text-green-800' : 'text-red-800'}`}>ä»Šæ—¥å‡€åˆ©æ¶¦</p><p className={`text-7xl font-extrabold ${isProfit ? 'text-green-600' : 'text-red-600'}`}>{result.netProfit.toFixed(2)} å…ƒ</p></div>
                        <hr className="my-8 border-t-4 border-dashed border-gray-300" />
                        <div className="bg-gray-100 border-2 border-gray-300 rounded-xl p-6 text-center mb-8"><h2 className="text-3xl font-bold text-gray-800 mb-4">æˆæœ¬é€è§†</h2><p className="text-2xl text-gray-700">ä»Šå¤©æ€»å…±å–äº† <span className="font-bold text-3xl text-black">{result.totalWeightSold.toFixed(1)}</span> æ–¤</p><p className="text-2xl text-gray-700 mt-2">ä»Šæ—¥æ€»æ‚è´¹ <span className="font-bold text-3xl text-black">{result.totalMiscFees.toFixed(2)}</span> å…ƒ</p><p className="text-sm text-gray-500 mt-1">(äººå·¥+ç‚‰å­+ç©ºè°ƒ+æ²¹è´¹+è¢‹å­+çƒ‚è´§æˆæœ¬)</p></div>
                        <div className="bg-orange-50 border-2 border-orange-300 rounded-xl p-6 text-center">
                            <h2 className="text-3xl font-bold text-orange-800 mb-4">ä»Šæ—¥ä¿æœ¬çº¢çº¿</h2><p className="text-2xl text-orange-900">ä½ çš„å®é™…æˆæœ¬ä»·æ˜¯ï¼š</p><p className="text-6xl font-extrabold text-orange-600 my-2">{result.actualBreakEvenPrice.toFixed(2)} å…ƒ/æ–¤</p>
                            {result.averageSellingPrice >= result.actualBreakEvenPrice ? (<div className="mt-4 bg-green-100 border border-green-400 rounded-lg p-3"><p className="text-2xl font-bold text-green-700">æ­å–œï¼å–ä»·åŒ…ä½äº†è´¹ç”¨</p><p className="text-xl text-green-600">å¹³å‡æ¯æ–¤èµšäº† <span className="font-bold">{(result.averageSellingPrice - result.actualBreakEvenPrice).toFixed(2)}</span> å…ƒ</p></div>) : (<div className="mt-4 bg-red-100 border border-red-400 rounded-lg p-3"><p className="text-2xl font-bold text-red-700">è­¦å‘Šï¼å®é™…åœ¨äºæœ¬</p><p className="text-xl text-red-600">å¹³å‡æ¯æ–¤äºäº† <span className="font-bold">{(result.actualBreakEvenPrice - result.averageSellingPrice).toFixed(2)}</span> å…ƒ</p></div>)}
                        </div>
                        <div className="mt-8"><button onClick={handleCopy} className="w-full bg-green-600 text-white text-3xl font-bold py-5 rounded-xl shadow-lg hover:bg-green-700 active:scale-95 transition-transform">å¤åˆ¶ä»Šæ—¥è´¦å•å‘å¾®ä¿¡</button></div>
                    </>)}
                </div>
            );
        };

        // --- Page 3: Marketing Tools (å–è´§ç¥å™¨) ---
        const MarketingTools = () => {
            const [slogan, setSlogan] = useState('è‡ªå®¶ç§ å˜å˜ç”œ');
            const [wholesalePrice, setWholesalePrice] = useState('2.2');
            const [retailPrice, setRetailPrice] = useState('2.8');
            const [posterVisible, setPosterVisible] = useState(false);

            const [copyStyle, setCopyStyle] = useState('enthusiastic');
            const [generatedCopy, setGeneratedCopy] = useState('');

            useEffect(() => {
                try {
                    const savedSettings = JSON.parse(localStorage.getItem(SETTINGS_KEY));
                    if (savedSettings) {
                        setWholesalePrice(savedSettings.wholesalePrice ?? '2.2');
                        setRetailPrice(savedSettings.retailPrice ?? '2.8');
                    }
                } catch (error) { console.error("Failed to load marketing settings", error); }
            }, []);

            const copyTemplates = {
                enthusiastic: [
                    "ğŸ”¥ åˆšå‡ºåœŸçš„çº¢è–¯ï¼{PRICE}å…ƒä¸€æ–¤ï¼ä¸ªä¸ªæµæ²¹ï¼Œä¸ç”œä¸è¦é’±ï¼å¿«æ¥æŠ¢ï¼",
                    "ğŸ‰ å¤§å–‡å­å¹¿æ’­ï¼ä»Šå¤©çº¢è–¯ç‰¹ä»·ï¼Œåªè¦{PRICE}å…ƒï¼åˆæ²™åˆç”œï¼Œçƒ¤ç€åƒç…®ç€åƒéƒ½ç¾æ»‹æ»‹ï¼",
                    "ğŸ“¢ èµ°è¿‡è·¯è¿‡ä¸è¦é”™è¿‡ï¼æ–°é²œçº¢è–¯{PRICE}å…ƒä¸€æ–¤ï¼Œç”œè¿‡åˆæ‹ï¼Œè¥å…»ç¾å‘³ï¼Œæ•°é‡æœ‰é™ï¼Œå…ˆåˆ°å…ˆå¾—ï¼"
                ],
                heartfelt: [
                    "ğŸŒ± çˆ¶æ¯ç§ç‚¹åœ°ä¸å®¹æ˜“ï¼Œéƒ½æ˜¯æ±—æ°´æ¢æ¥çš„è‰¯å¿ƒè´§ã€‚åªè¦{PRICE}å…ƒï¼Œå°å°è¿™å£å®åœ¨çš„ç”œã€‚",
                    "ğŸ‘¨â€ğŸŒ¾ æ²¡æœ‰é‚£ä¹ˆå¤šèŠ±é‡Œèƒ¡å“¨ï¼Œå°±æ˜¯è€è€å®å®ç§å‡ºæ¥çš„çº¢è–¯ï¼Œ{PRICE}å…ƒä¸€æ–¤ï¼Œåƒå¾—æ”¾å¿ƒã€‚",
                    "â¤ï¸ å¤©å†·äº†ï¼Œçƒ¤ä¸ªçƒ­ä¹ä¹çš„çº¢è–¯æš–æš–æ‰‹å§ã€‚è‡ªå®¶äº§çš„ï¼Œ{PRICE}å…ƒï¼Œæ˜¯å°æ—¶å€™çš„å‘³é“ã€‚"
                ],
                clearance: [
                    "ğŸ“¢ æœ€ååŠè½¦ï¼Œäºæœ¬æ¸…ä»“ï¼{PRICE}å…ƒæ‹¿èµ°ï¼å†ä¸æ¥å°±çœŸæ²¡äº†ï¼Œæ‰‹æ…¢æ— ï¼",
                    "ğŸ’¨ æœ€åå‡ å°æ—¶ï¼Œå–å®Œæ”¶æ‘Šï¼çº¢è–¯{PRICE}å…ƒä¸€æ–¤ï¼Œç»™é’±å°±å–ï¼Œä¸è®¡æˆæœ¬äº†ï¼",
                    "â€¼ï¸ ç´§æ€¥ç”©è´§ï¼å®¶é‡Œæœ‰äº‹æ€¥ç€èµ°ï¼Œçº¢è–¯{PRICE}å…ƒï¼Œå¸®å¸®å¿™ç»™ä¸ªæ²¹é’±å°±è¡Œï¼"
                ]
            };
            
            const generateCopy = () => {
                const templates = copyTemplates[copyStyle];
                const randomIndex = Math.floor(Math.random() * templates.length);
                const template = templates[randomIndex];
                const priceToUse = copyStyle === 'clearance' ? wholesalePrice : retailPrice;
                const newCopy = template.replace('{PRICE}', priceToUse);
                setGeneratedCopy(newCopy);
            };

            const handleCopyToClipboard = () => {
                if (!generatedCopy) {
                    alert("è¯·å…ˆç”Ÿæˆæ–‡æ¡ˆï¼");
                    return;
                }
                navigator.clipboard.writeText(generatedCopy)
                    .then(() => alert("æ–‡æ¡ˆå·²å¤åˆ¶ï¼å¿«å»ç²˜è´´å§ï¼"))
                    .catch(err => alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚"));
            };

            const today = new Date();
            const formattedDate = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;

            return (
                <div className="w-full max-w-lg bg-white p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-200">
                    <h1 className="text-4xl sm:text-5xl font-bold text-slate-800 text-center mb-8">å–è´§ç¥å™¨</h1>
                    
                    {/* --- Module 1: Poster Generator --- */}
                    <div className="bg-red-50 border-2 border-red-200 rounded-xl p-6 mb-8">
                        <h2 className="text-3xl font-bold text-red-800 mb-4">ä¸€é”®ç”ŸæˆæŠ¥ä»·æµ·æŠ¥</h2>
                        <div className="mb-4">
                            <label className="block text-2xl font-medium text-gray-700 mb-2">ä»Šæ—¥ä¸»æ‰“è¯­</label>
                            <input type="text" value={slogan} onChange={e => setSlogan(e.target.value)} className="w-full text-3xl p-3 border-2 border-gray-300 rounded-lg"/>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                               <label className="block text-2xl font-medium text-gray-700 mb-2">æ‰¹å‘ä»·</label>
                               <input type="number" value={wholesalePrice} onChange={e => setWholesalePrice(e.target.value)} className="w-full text-3xl p-3 border-2 border-gray-300 rounded-lg" />
                            </div>
                            <div>
                               <label className="block text-2xl font-medium text-gray-700 mb-2">é›¶å”®ä»·</label>
                               <input type="number" value={retailPrice} onChange={e => setRetailPrice(e.target.value)} className="w-full text-3xl p-3 border-2 border-gray-300 rounded-lg" />
                            </div>
                        </div>
                        <button onClick={() => setPosterVisible(true)} className="w-full bg-red-600 text-white text-3xl font-bold py-5 rounded-xl shadow-lg hover:bg-red-700 active:scale-95 transition-transform">ç”Ÿæˆæµ·æŠ¥é¢„è§ˆ</button>
                    </div>

                    {/* Poster Modal */}
                    {posterVisible && (
                        <div className="fixed inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center z-50 p-4">
                            <div className="bg-red-600 border-[10px] border-yellow-400 rounded-2xl p-6 text-yellow-300 w-full max-w-md text-center shadow-2xl relative">
                                <button onClick={() => setPosterVisible(false)} className="absolute -top-4 -right-4 bg-white text-red-600 rounded-full h-12 w-12 text-3xl font-bold border-4 border-red-600">X</button>
                                <p className="text-4xl font-bold mb-2">{formattedDate}</p>
                                <p className="text-6xl font-extrabold tracking-widest border-b-4 border-dashed border-yellow-400 pb-4 mb-4">ä»Šæ—¥æŠ¥ä»·</p>
                                <div className="my-6">
                                    <p className="text-5xl font-bold">é›¶å”®: <span className="text-8xl font-black">{retailPrice}</span> å…ƒ</p>
                                    <p className="text-5xl font-bold mt-4">æ‰¹å‘: <span className="text-8xl font-black">{wholesalePrice}</span> å…ƒ</p>
                                </div>
                                <p className="text-5xl font-bold bg-black bg-opacity-20 rounded-lg py-2">{slogan}</p>
                                <p className="text-4xl font-semibold mt-4">æ¬¢è¿å“å°</p>
                            </div>
                            <p className="text-white text-3xl font-bold mt-6 text-center">ğŸ‘† è¯·ç›´æ¥æ‰‹æœºæˆªå›¾å‘æœ‹å‹åœˆ ğŸ‘†</p>
                        </div>
                    )}


                    {/* --- Module 2: AI Copywriter --- */}
                    <div className="bg-green-50 border-2 border-green-200 rounded-xl p-6 mb-8">
                        <h2 className="text-3xl font-bold text-green-800 mb-4">AI é‡‘ç‰Œé”€å”®æ–‡æ¡ˆ</h2>
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            <button onClick={() => setCopyStyle('enthusiastic')} className={`py-3 text-xl font-bold rounded-lg ${copyStyle === 'enthusiastic' ? 'bg-green-600 text-white' : 'bg-green-200'}`}>çƒ­æƒ…å†å–</button>
                            <button onClick={() => setCopyStyle('heartfelt')} className={`py-3 text-xl font-bold rounded-lg ${copyStyle === 'heartfelt' ? 'bg-green-600 text-white' : 'bg-green-200'}`}>æƒ…æ„Ÿèµ°å¿ƒ</button>
                            <button onClick={() => setCopyStyle('clearance')} className={`py-3 text-xl font-bold rounded-lg ${copyStyle === 'clearance' ? 'bg-green-600 text-white' : 'bg-green-200'}`}>ç´§æ€¥ç”©è´§</button>
                        </div>
                        <button onClick={generateCopy} className="w-full bg-green-600 text-white text-3xl font-bold py-5 rounded-xl shadow-lg hover:bg-green-700 active:scale-95 transition-transform mb-4">å¸®æˆ‘æƒ³ä¸ªè¯</button>
                        {generatedCopy && (
                            <div className="mt-4">
                                <textarea readOnly value={generatedCopy} className="w-full text-2xl p-4 border-2 bg-white border-gray-300 rounded-lg h-48 mb-4"></textarea>
                                <button onClick={handleCopyToClipboard} className="w-full bg-blue-600 text-white text-3xl font-bold py-5 rounded-xl shadow-lg hover:bg-blue-700 active:scale-95 transition-transform">ä¸€é”®å¤åˆ¶æ–‡æ¡ˆ</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }


        // --- Main App Component with Navigation ---
        const BottomNav = ({ activeTab, setActiveTab }) => {
            const navItemClasses = "flex-1 text-center py-4 text-2xl font-bold transition-colors duration-300";
            const activeClasses = "bg-blue-600 text-white";
            const inactiveClasses = "bg-gray-200 text-gray-700 hover:bg-gray-300";

            return (
                <nav className="fixed bottom-0 left-0 right-0 h-24 bg-white shadow-[0_-5px_15px_-3px_rgba(0,0,0,0.1)] flex items-center justify-around z-40">
                    <button onClick={() => setActiveTab('advisor')} className={`${navItemClasses} ${activeTab === 'advisor' ? activeClasses : inactiveClasses}`}>
                        è¿›è´§å‚è€ƒ
                    </button>
                    <div className="w-px h-16 bg-gray-300"></div>
                    <button onClick={() => setActiveTab('ledger')} className={`${navItemClasses} ${activeTab === 'ledger' ? activeClasses : inactiveClasses}`}>
                        ä»Šæ—¥è®°è´¦
                    </button>
                    <div className="w-px h-16 bg-gray-300"></div>
                    <button onClick={() => setActiveTab('marketing')} className={`${navItemClasses} ${activeTab === 'marketing' ? activeClasses : inactiveClasses}`}>
                        å–è´§ç¥å™¨
                    </button>
                </nav>
            );
        };

        function App() {
            const [activeTab, setActiveTab] = useState('ledger');

            return (
                <div className={`min-h-screen bg-slate-100 flex items-start justify-center p-4 pb-32`}>
                   {activeTab === 'advisor' && <PurchaseAdvisor />}
                   {activeTab === 'ledger' && <DailyLedger />}
                   {activeTab === 'marketing' && <MarketingTools />}
                   <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
                </div>
            );
        }

        // --- Mount the App to the DOM ---
        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
  </body>
</html>
